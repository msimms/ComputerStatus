<!DOCTYPE html>
<html lang="en-US">

<head>

<title>Dashboard</title>

<link rel="stylesheet" href="${root_url}/css/normalize.css">
<link rel="stylesheet" href="${root_url}/css/site.css">

<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
	
<link rel="shortcut icon" href="${root_url}/media/favicon.ico" >

</head>

<body>

<script type="text/javascript" src="${root_url}/js/all.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js" integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE=" crossorigin="anonymous"></script>

<script>
	function on_delete(device_id)
	{
		if (confirm('Are you sure you want to do this?'))
		{
			var the_url = "${root_url}/delete_device";
			var dict = [];

			dict.push({["device_id"] : device_id});
			if (send_post_request(the_url, dict))
				window.location.replace("${root_url}/dashboard");
			else
				alert("An error occurred!");
		}
	}

	function on_trim(device_id)
	{
        $("#datepicker").datepicker({
            showOn: "button",
            buttonImage: "https://jqueryui.com/resources/demos/datepicker/images/calendar.gif",
            buttonImageOnly: true,
            buttonText: "Select date"
        });
	}

    function append_to_devices_table(table, device_id, device_name)
    {
        // Create a new row.
        var new_row = table.insertRow();

        // Create a cell for the ID.
        var cell = new_row.insertCell();
        var a = document.createElement('a');
        var link_text = document.createTextNode(device_id);
        a.appendChild(link_text);
        a.title = device_id;
        a.href = "${root_url}/device/" + device_id;
        cell.appendChild(a);

        // Create a cell for the name.
        cell = new_row.insertCell();
        text = document.createTextNode(device_name);
        cell.appendChild(text);

        // Create a delete button.
        cell = new_row.insertCell();
        var delete_button = document.createElement('button');
        var delete_button_text = document.createTextNode('Delete');
        delete_button.appendChild(delete_button_text);
        delete_button.title = "Delete";
        delete_button.addEventListener('click', function() { on_delete(device_id); });
        cell.appendChild(delete_button);
    }

    var process_device_list = function(records)
    {
		var device_table = document.getElementById("devices");

        for (var record of records)
        {
            append_to_devices_table(device_table, record.id, record.name);
        }
    }

    function get_device_list()
    {
		$.ajax({ type: 'GET', url: "${root_url}/api/1.0/list_devices", cache: false, success: process_device_list, dataType: "json" });
    }

    get_device_list();
</script>

<section class="nav">
${nav}
</section>

<div id="dashboard">
    <table id="devices">
        <td><b>Name</b></td><td><b>Device ID</b></td><td></td><tr>
    </table>
</div>

<section class="claim_device cf">
    <div>
        <p>
            Enter the Device ID you wish to claim:
        </p>
		<form name="claim_device" action="${root_url}/claim_device" method="post" accept-charset="utf-8">
			<ul>
				<li>
					<input type="device_id" name="device_id" style="width: 500px" placeholder="" required>
				</li>
				<li>
					<input type="submit" value="Claim">
				</li>
			</ul>
		</form>
        <p>
            <b>Note:</b> The device ID is generated by the client the first time it is run. It can be found in a file called 'device_id.txt'.
        </p>
    </div>
</section>

</body>

</html>
